@model Wing_Fleet_Manager.ViewModel.VehuclesViewModel

@* Page Layout *@
<div class="container-fluid">
    <div class="row mt-3 d-flex justify-content-between align-items-center g-3">
        @* Page Header *@
        <div class="col-12 col-lg-4">
            <h2><i class="fa-solid fa-motorcycle my-3" style="margin-right:10px"></i> Vehicles Management</h2>
        </div>
        <div class="col-12 col-lg-1 mt-2 text-end">
            <button class="btn btn-primary" style="background-color:#0097A7; border-color:#0097A7" data-bs-toggle="modal" data-bs-target="#createVehicle"><i class="fa-solid fa-plus"></i></button>
        </div>
    </div>

    @*vehicles Table*@
    <div class="row">
        @{
            int index = 1;
        }
        <table class="table table-striped table-hover align-middle my-3 text-center">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Qr</th>
                    <th>Type</th>
                    <th>Company</th>
                    <th>Zone</th>
                    <th>Active?</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var vehicle in Model.Vehicles)
                {
                    <tr>
                        <td>@index</td>
                        <td>@vehicle.Qr</td>
                        <td>@vehicle.Type</td>
                        <td>@vehicle.Company</td>
                        <td>
                            
                            @{
                                var zoneName = Model.ZonesEnum?.FirstOrDefault(z => z.Id == vehicle.ZoneId)?.Name;
                            }
                            @if (!string.IsNullOrEmpty(zoneName))
                            {
                                @zoneName
                            }
                            else
                            {
                                <span class="text-muted">No Zone</span>
                            }
                        </td>
                        <td>
                            @if (vehicle.IsActive)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">In Active</span>
                            }
                        </td>
                        <td>@if (vehicle.Status == VehicleStatus.Working)
                            {
                                <span class="badge bg-success">Working</span>
                            }
                            else if (vehicle.Status == VehicleStatus.UnderMaintenance)
                            {
                                <span class="badge bg-warning">Under Maintenance</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Faulty</span>
                            }
                        </td>
                        
                        <td>
                            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#readvehicle_@vehicle.Id">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#updatevehicle_@vehicle.Id">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deletevehicle_@vehicle.Id">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    index++;
                }
            </tbody>
        </table>
    </div>

    @*Read Vehicle Modal*@
    @foreach (var vehicle in Model.Vehicles)
    {
        <div class="modal fade" id="readvehicle_@vehicle.Id">
            <div class="modal-dialog modal-dialog-scrollable modal-fullscreen ">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Read Vehicle Info</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body bg-secondary">
                        <div class="container-fluid">
                            <div class="row justify-content-center align-content-center my-3 text-center align-middle">
                                <div class="col-12 col-lg-6">
                                    <div class="card p-3" style="font-size:18px;">
                                        <h2>
                                            <i class="fa-solid fa-circle-info"></i>
                                            Vehicle Info</h2>
                                        <table class="table table-hover">
                                            <tr>
                                                <td class="fw-bold">Vehicle Qr</td>
                                                <td>@vehicle.Qr</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Mac</td>
                                                <td>@vehicle.Mac</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Imei</td>
                                                <td>@vehicle.Imei</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Vehicle Type</td>
                                                <td>@vehicle.Type</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Company</td>
                                                <td>@vehicle.Company</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Zone</td>
                                                <td>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Is Active?</td>
                                                @if (vehicle.IsActive)
                                                {
                                                    <td>Active</td>
                                                }
                                                else{
                                                    <td>In Active</td>
                                                }
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Status</td>
                                                <td>@vehicle.Status</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Created At</td>
                                                <td>@vehicle.CreatedAt.ToLocalTime()</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Last Updated At</td>
                                                <td>@vehicle.LastUpdatedAt.ToLocalTime()</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                            </div>

                            @*Faults History*@
                            <div class="row justify-content-center align-items-center">
                                <div class="col-12 col-lg-10">
                                    <div class="card p-3">
                                            <h2 class="text-center">
                                            <i class="fa-solid fa-clock-rotate-left"></i>
                                                Faults History
                                            </h2>
                                           
                                            <table class="table table-striped table-hover align-middle text-center">
                                                <thead>
                                                    <tr>
                                                        <th>Serial Number</th>
                                                        <th>Title</th>
                                                        <th>Description</th>
                                                        <th>Type</th>
                                                        <th>Priority</th>
                                                        <th>Solved ?</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                @if (vehicle.Faults != null&& vehicle.Faults.Any())
                                                {
                                                    @foreach (var fault in vehicle.Faults.Where(f => !f.IsDeleted))
                                                    {
                                                        <tr>
                                                            <td>@fault.SerialNumber</td>
                                                            <td>@fault.Title</td>
                                                            <td>@fault.Description</td>
                                                            <td>@fault.Type</td>
                                                            <td>
                                                                @if (fault.Priority == FaultPriority.Critical)
                                                                {
                                                                    <span class="badge bg-danger">Critical</span>
                                                                }
                                                                else if (fault.Priority == FaultPriority.High)
                                                                {
                                                                    <span class="badge bg-warning">High</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge bg-info">Normal</span>
                                                                }
                                                            </td>
                                                            <td>
                                                                @if(fault.IsSolved == true)
                                                                {
                                                                    <span class="badge bg-success">Solved</span>
                                                                }
                                                                else{
                                                                    <span class="badge bg-danger">In Progress</span>
                                                                }
                                                            </td>
                                                        </tr>
                                                    }


                                                }
                                                </tbody>
                                            </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                                            
                    <div class="modal-footer bg-secondary"></div>
                </div>
            </div>
        </div>
    }


    @*Create Vehicle Modal*@
    <div class="modal fade" id="createVehicle">
        <div class="modal-dialog modal-lg  modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Create New Vehicle</h4>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form asp-action="Create" asp-controller="Vehicles" method="post" id="createVehicleform">
                        @Html.AntiForgeryToken()
                        <div class="p-3">
                            <input type="text" asp-for="vehicleCreateDto.Qr" class="form-control" placeholder="Vehicle Qr" />
                            <span asp-validation-for="vehicleCreateDto.Qr" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <select class="form-control" asp-for="vehicleCreateDto.Type"
                                    asp-items="Html.GetEnumSelectList<VehicleType>()">
                            </select>
                        </div>
                        <div class="p-3">
                            <select class="form-control" asp-for="vehicleCreateDto.Company"
                                    asp-items="Html.GetEnumSelectList<VehicleCompany>()">
                            </select>
                        </div>
                        <div class="p-3">
                            <input type="number" asp-for="vehicleCreateDto.Imei" class="form-control" placeholder="Vehicle Imei" />
                            <span asp-validation-for="vehicleCreateDto.Imei" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="text" asp-for="vehicleCreateDto.Mac" class="form-control" placeholder="Vehicle Mac" />
                            <span asp-validation-for="vehicleCreateDto.Mac" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                                <input type="checkbox" asp-for="vehicleCreateDto.IsActive" />
                                <label>Active?</label>
                        </div>
                        <div class="p-3">
                            <select class="form-control" asp-for="vehicleCreateDto.Status"
                                    asp-items="@Html.GetEnumSelectList<VehicleStatus>()">
                            </select>
                        </div>

                        <div class="p-3">
                            <select class="form-control" asp-for="vehicleCreateDto.ZoneId">
                                <option value="">Select Zone</option>
                                @if(Model.ZonesEnum!= null)
                                {
                                    @foreach(var zone in Model.ZonesEnum)
                                    {
                                        <option value="@zone.Id">@zone.Name</option>
                                    }
                                }
                             </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit" form="createVehicleform">Create</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    @*Update Vehicle Modal*@
    @foreach (var vehicle in Model.Vehicles)
    {
        <div class="modal fade" id="updatevehicle_@vehicle.Id">
            <div class="modal-dialog modal-xl modal-dialog-scrollable" >
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Update Vehicle</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form asp-action="Update" asp-controller="Vehicles" id="updateForm_@vehicle.Id">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="Id" value="@vehicle.Id" />
                            <div class="px-3">
                                <label>Qr</label>
                                <input class="form-control" name="Qr" value="@vehicle.Qr" type="text"  />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Imei</label>
                                <input class="form-control" name="Imei" value="@vehicle.Imei" type="number" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Mac</label>
                                <input class="form-control mt-1" name="Mac" value="@vehicle.Mac" type="text" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Is Active?</label>
                                <input class="mt-1" type="checkbox" name="IsActive" value="true" @(vehicle.IsActive ? "checked" : "") />
                            </div>
                            <div class="px-3 pt-2 ">
                                <label>Type</label>
                                <select class="form-control" name="Type" asp-for="@vehicle.Type"
                                        asp-items="Html.GetEnumSelectList<VehicleType>()">
                                </select>
                            </div>
                            <div class="px-3 pt-2 ">
                                <label>Company</label>
                                <select class="form-control" name="Company" asp-for="@vehicle.Company"
                                        asp-items="Html.GetEnumSelectList<VehicleCompany>()">
                                </select>
                            </div>
                            <div class="px-3 pt-2 ">
                                <label>Status</label>
                                <select class="form-control" name="Status" asp-for="@vehicle.Status"
                                        asp-items="@Html.GetEnumSelectList<VehicleStatus>()">
                                </select>
                            </div>

                            <div class="modal-footer">
                                <button class="btn btn-primary btn-sm" type="submit">Update</button>
                                <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    }


    @*Delete Vehicle Modal*@
    @foreach (var vehicle in Model.Vehicles)
    {
        <div class="modal fade" id="deletevehicle_@vehicle.Id">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Delete Vehicle</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Do you want to remove this Vehicle ?
                        </p>
                    </div>
                    <div class="modal-footer">
                        <form asp-action="Delete" asp-controller="Vehicles" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@vehicle.Id" />
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }


    @*Pagination*@
    <div class="row d-flex justify-content-end fixed-bottom px-5 py-1">
        <div class="col-12 d-flex justify-content-end">
            <nav>
                @Html.PagedListPager(
                Model.Vehicles,
                                page => Url.Action("Index", new { page }),
                                new PagedListRenderOptions
                                {
                                    DisplayLinkToFirstPage = PagedListDisplayMode.Never,
                                    DisplayLinkToLastPage = PagedListDisplayMode.Never,
                                    DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                                    DisplayLinkToNextPage = PagedListDisplayMode.Always,

                                    MaximumPageNumbersToDisplay = 3,

                                    LiElementClasses = new[] { "page-item" },
                                    PageClasses = new[] { "page-link" }
                                }
                                )
            </nav>
        </div>
    </div>
</div>