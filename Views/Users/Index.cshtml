@model Wing_Fleet_Manager.ViewModel.UsersViewModel

@* Page Layout *@

<div class="container-fluid">
    <div class="row mt-3 d-flex justify-content-between align-items-center g-3">
        @* Page Header *@
        <div class="col-12 col-lg-4">
            <h2><i class="fa fa-users my-3" style="margin-right:10px"></i>Users Mangement</h2>
        </div>
        <div class="col-12 col-lg-1 mt-2 text-end">
            <button class="btn btn-primary" style="background-color:#0097A7; border-color:#0097A7" data-bs-toggle="modal" data-bs-target="#createuser"><i class="fa-solid fa-plus"></i></button>
        </div>
    </div>

    @*Users Table*@
    <div class="row">
        @{
            int index = 1;
        }
        <table class="table table-striped table-hover align-middle my-3">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Active?</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Users)
                {
                    <tr>
                        <td>@index</td>
                        <td>@user.FullName</td>
                        <td>@user.Email</td>
                        <td>@user.RoleName</td>
                        <td>
                            @if (user.IsActive)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">In Active</span>
                            }
                        </td>
                        <td>
                            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#readuser_@user.Id">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#updateuser_@user.Id">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteuser_@user.Id">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    index++;
                }
            </tbody>
        </table>
    </div>

    @*Read User Modal*@
    @foreach(var user in Model.Users)
    {
        <div class="modal fade" id="readuser_@user.Id">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Read User Info</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row justify-content-center align-content-center">
                                <div class="col-12 col-lg-6">
                                    <img src="/AdminAvatar.png" alt="Wing" style="width:200px; border-radius:50%" />
                                </div>
                            </div>
                            <div class="row justify-content-center align-content-center my-3">
                                <div class="col-12 col-lg-10">
                                    <div class="card p-3">
                                        <h4>Full Name : @user.FullName</h4>
                                        <h5>Nick Name : @user.NickName</h5>
                                        <h5>Role : @user.RoleName</h5>
                                        <h5>Phone : @user.Phone</h5>
                                        <h5>Active? : @user.IsActive</h5>
                                        <h5>Created At : @user.CreatedAt.ToLocalTime()</h5>
                                        <h5>Last Login : @user.LastLoginAt.ToLocalTime()</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer"></div>
                </div>
            </div>
        </div>
    }


    @*Create User Modal*@
    <div class="modal fade" id="createuser">
        <div class="modal-dialog modal-lg  modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Create New User</h4>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form asp-action="Create" asp-controller="Users" asp-for="CreateUser" method="post" id="createuserform">
                        @Html.AntiForgeryToken()
                        <div class="p-3">
                            <input type="text" asp-for="CreateUser.FullName" class="form-control" placeholder="Full Name" />
                            <span asp-validation-for="CreateUser.FullName" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="text" asp-for="CreateUser.NickName" class="form-control" placeholder="Nick Name" />
                            <span asp-validation-for="CreateUser.NickName" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="email" asp-for="CreateUser.Email" class="form-control" placeholder="Email" />
                            <span asp-validation-for="CreateUser.Email" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="password" asp-for="CreateUser.Password" class="form-control" placeholder="Password" />
                            <span asp-validation-for="CreateUser.Password" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="password" asp-for="CreateUser.ConfirmPassword" class="form-control" placeholder="Confirm Password" />
                            <span asp-validation-for="CreateUser.ConfirmPassword" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <input type="number" asp-for="CreateUser.Phone" class="form-control" placeholder="Phone" />
                            <span asp-validation-for="CreateUser.Phone" class="text-danger"></span>
                        </div>
                        <div class="p-3">
                            <select asp-for="CreateUser.RoleId" class="form-control">
                                <option value="1">Admin</option>
                            </select>
                            <span asp-validation-for="CreateUser.RoleId" class="text-danger"></span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit" form="createuserform">Create</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    @*Update User Modal*@
    @foreach (var user in Model.Users)
    {
        <div class="modal fade" id="updateuser_@user.Id">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Update User</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form asp-action="Update" asp-controller="Users" id="updateForm_@user.Id">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="Id" value="@user.Id" />
                            <div class="px-3">
                                <label>Full Name</label>
                                <input class="form-control" value="@user.FullName" type="text" name="FullName" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Nick Name</label>
                                <input class="form-control" value="@user.NickName" type="text" name="NickName" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Email</label>
                                <input class="form-control mt-1" value="@user.Email" type="email" name="Email" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Phone</label>
                                <input class="form-control mt-1" value="@user.Phone" type="number" name="Phone" />
                            </div>
                            <div class="px-3 pt-2">
                                <label>Is Active?</label>

                                <input class="mt-1" type="checkbox" name="IsActive" value="true" @(user.IsActive ? "checked" : "") />
                            </div>
                            <div class="px-3 pt-2 my-5">
                                <select class="form-control" name="RoleId">
                                    @if (user.RoleId == 1)
                                    {
                                        <option value="1" selected>Admin</option>
                                        <option value="2">Employee</option>
                                    }
                                    else
                                    {
                                        <option value="1">Admin</option>
                                        <option value="2" selected>Employee</option>
                                    }
                                </select>

                            </div>


                            <div class="modal-footer">
                                <button class="btn btn-primary btn-sm" type="submit">Update</button>
                                <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    }


    @*Delete User Modal*@
    @foreach(var user in Model.Users)
    {
        <div class="modal fade" id="deleteuser_@user.Id">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Delete User</h4>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Do you want to remove this user ?
                        </p>
                    </div>
                    <div class="modal-footer">
                        <form asp-action="Delete" asp-controller="Users" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@user.Id" />
                            <button class="btn btn-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }

   
</div>
